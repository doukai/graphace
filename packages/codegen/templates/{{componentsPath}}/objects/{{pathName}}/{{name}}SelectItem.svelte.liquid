<script lang="ts">
	import type { Errors } from '@graphace/commons';
	import { FormItem } from '@graphace/ui';
	import type { Option } from '@graphace/ui';
	import {{ name }}Select from './{{ name }}Select.svelte';
	import type { {{ name }}Input } from '$houdini';

	export let value: {{ name }}Input | ({{ name }}Input | null | undefined)[] | null | undefined = undefined;
	export let list: boolean = false;
	export let name: string;
	export let label: string;
	export let errors: Errors | undefined = undefined;
	export let readonly = false;
	export let disabled = false;
	export let placeholder: string = '';
	
	let selected: Option | Option[] | undefined;

	if (Array.isArray(value)) {
		selected = value?.map((item) => ({
			label: item?.name,
			value: item?.{{ idName }}
		}));
		value = value.map((item) => ({ where: { {{ idName }}: { val: item?.{{ idName }} } } }));
	} else if (value) {
		selected = { label: value.name, value: value.{{ idName }} };
		value = { where: { {{ idName }}: { val: value.{{ idName }} } } };
	}
</script>

<FormItem {label} let:id>
	<{{ name }}Select
		{id}
		{name}
		{list}
		{disabled}
		{readonly}
		{placeholder}
		{errors}
		bind:value
		bind:selected
	/>
</FormItem>
